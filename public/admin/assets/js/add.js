import{n as $e,m as qe,u as he,G as Ge,r as ze,N as He,s as Je,O as Ze,P as Ke,Q as Qe,R as We,S as Xe,T as Ye,b as el,U as ll,g as al,o as tl,C as ol,I as sl,L as ul,M as nl,B as dl,D as rl,q as ml,a as b}from"./element-plus.js";import{W as te,r as m,n as il,ab as A,c as V,o as d,a as w,O as l,L as t,K as c,H as P,T as O,a3 as _,I as k,ac as U,U as F}from"./@vue.js";import{u as pl}from"./vue-router.js";import{f as cl}from"./category.js";import{f as fl,d as vl,c as _l}from"./article.js";import{s as gl}from"./tag.js";import{v as Vl}from"./sys_config.js";import{t as bl,_ as yl}from"./tinymce.js";import{u as oe}from"./upload.js";import{_ as wl,a as se,t as kl,b as Ul,c as El,f as Cl}from"./index.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const xl={class:"bg-fff pd-10 radius-6"},Il={class:"mr-10 ml-10"},jl={class:"mr-10 ml-10 mb-20"},Dl={class:"cover row"},Al={key:0,class:"cover flex align-center"},Pl={class:"imgs-btn"},Sl={__name:"add",setup(Rl){const ue=pl(),ne=te({...bl}),M=m(!0),$=m([-1]),de={checkStrictly:!0},q=m("first"),x=m("0"),h=m([]),re=m([]),G=m([]),S=m(!1),R=m(!1),z=m(1),H=m([]),T=m(),J=m(),me=m(""),s=te({cid:0,title:"",shortTitle:"",tagId:"",attr:[],articleView:"",source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用ChanCMS系统",status:"0",pv:1,link:""}),g=m([]),Z=m(""),L=m(!1),ie=m(1),N=m(!1),pe=m(["/public/cover/01.jpg","/public/cover/02.jpg","/public/cover/03.jpg","/public/cover/04.jpg","/public/cover/05.jpg","/public/cover/06.jpg","/public/cover/07.jpg","/public/cover/08.jpg","/public/cover/09.jpg","/public/cover/10.jpg"]),ce=async()=>{try{const o=await Vl();o.code===200&&(G.value=o.data.filter(e=>!["404.html","500.html"].includes(e)).map(e=>({label:e,value:e})))}catch(o){console.error(o)}},K=async o=>{try{const e=await gl(ie.value,o);e.code===200&&e.data&&(H.value=e.data.list.map(u=>({label:u.name,value:u.id})))}catch(e){console.error(e)}},fe=async()=>{try{const o=await cl();if(o.code===200){const e=se(kl(o.data)),u=se(o.data);re.value=u,h.value=[...e]}}catch(o){console.error(o)}},ve=o=>{o[0]!==-1?(s.cid=o[o.length-1],_e(s.cid)):g.value=[]},_e=async o=>{try{const e=await fl(o);e.code===200&&(e.data.fields.forEach(u=>{if(u.default&&u.default.includes("[")&&u.default.includes("options")){const p=JSON.parse(u.default);u.default=p.options||[]}u.type==="8"&&(u.values=[])}),g.value=e.data.fields)}catch(e){console.error(e)}},ge=()=>{M.value=!1},Ve=o=>{s.img=o},be=o=>{x.value=o.index},ye=o=>{if(o.type.indexOf("image")===-1)return b({message:"上传文件只能是图片格式",type:"success"}),!1;T.value=o;const e=new FileReader;return e.onload=async u=>{let p;typeof u.target.result=="object"?p=window.URL.createObjectURL(new Blob([u.target.result])):p=u.target.result,me.value=p},e.readAsArrayBuffer(o),!0},we=async()=>{if(T.value.size/1024/1024>.2)return b({message:"上传图片必须小于200k",type:"success"}),!1;const o=new FormData;o.append("file",T.value);const e=await oe(o,"1");e.code===200&&(s.img=e.data.path)},ke=o=>{if(o.type.indexOf("image")===-1)return b({message:"上传文件只能是图片格式",type:"success"}),!1;if(o.size/1024/1024>.2)return b({message:"上传图片必须小于200k",type:"success"}),!1},Ue=async o=>{const{data:{index:e},file:u}=o,p=new FormData;p.append("file",u);const f=await oe(p,"2");if(f.code===200){const n=f.data.map(i=>({name:i.filename,url:i.path}));Array.isArray(g.value[e].values)?g.value[e].values.push(...n):g.value[e].values=[...n]}},Ee=async o=>{Z.value=o.url,L.value=!0},Ce=async o=>{g.value.forEach((e,u)=>{Array.isArray(e.values)&&e.values.forEach((p,f)=>{p.url===o.url&&(xe(o.url),e.values.splice(f,1))})})},xe=async o=>{try{await vl(o)}catch(e){console.error(e)}},Ie=async()=>{try{const o={...s};o.attr=s.attr.toString(),o.tagId=s.tagId.toString(),!s.img&&S.value&&(s.img=El(s.content)[0]),!s.description&&R.value&&(s.description=Cl(s.content).substr(0,255));const e=g.value.reduce((p,f)=>(p[f.ename]=Array.isArray(f.values)?JSON.stringify(f.values):f.values,p),{}),u=await _l({defaultParams:o,fieldParams:e});u.code===200?(b({message:"新增成功^_^",type:"success"}),ue.go(-1)):b({message:u.msg,type:"error"})}catch(o){console.error(o)}},je=async o=>{o&&await o.validate((e,u)=>{if(e){if(s.cid===0){b({message:"请选择栏目^_^",type:"success"});return}Ie()}else Ul(u)})};return il(async()=>{await fe(),await K(),await ce()}),(o,e)=>{const u=$e,p=qe,f=He,n=ze,i=Ge,v=Je,De=Ze,y=Qe,Ae=Ke,Q=We,Pe=A("MostlyCloudy"),I=el,W=Ye,X=Xe,E=ll,Y=al,Se=tl,j=he,B=ol,ee=nl,le=ul,Re=dl,Te=A("ZoomIn"),Le=A("Delete"),Ne=rl,Be=A("Plus"),Oe=ml,Fe=sl;return d(),V("div",xl,[w("div",Il,[l(p,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),onTabClick:be},{default:t(()=>[l(u,{label:"基本信息",name:"first"}),l(u,{label:"扩展信息",name:"second"}),g.value.length>0?(d(),c(u,{key:0,label:"模型信息",name:"three"})):P("",!0)]),_:1},8,["modelValue"])]),w("div",jl,[l(Oe,{ref_key:"paramsRef",ref:J,model:s,"label-width":"90px"},{default:t(()=>[O((d(),V("div",null,[l(j,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"文章栏目"},{default:t(()=>[l(f,{props:de,"show-all-levels":!1,modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),options:h.value,onChange:ve},null,8,["modelValue","options"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"文章标题",prop:"title",rules:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:100,message:"标题不能超过100个字",trigger:"blur"}]},{default:t(()=>[l(v,{modelValue:s.title,"onUpdate:modelValue":e[2]||(e[2]=a=>s.title=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"tag标签"},{default:t(()=>[l(De,{modelValue:s.tagId,"onUpdate:modelValue":e[3]||(e[3]=a=>s.tagId=a),options:H.value,placeholder:"请选择标签",style:{width:"240px"},multiple:"",filterable:"",remote:"","remote-method":K},null,8,["modelValue","options"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"内容属性"},{default:t(()=>[l(Ae,{modelValue:s.attr,"onUpdate:modelValue":e[4]||(e[4]=a=>s.attr=a)},{default:t(()=>[l(y,{label:"1",value:"1"},{default:t(()=>e[24]||(e[24]=[_("头条")])),_:1}),l(y,{label:"2",value:"2"},{default:t(()=>e[25]||(e[25]=[_("推荐")])),_:1}),l(y,{label:"3",value:"3"},{default:t(()=>e[26]||(e[26]=[_("轮播")])),_:1}),l(y,{label:"4",value:"4"},{default:t(()=>e[27]||(e[27]=[_("热门")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"发布时间"},{default:t(()=>[l(Q,{modelValue:s.createdAt,"onUpdate:modelValue":e[5]||(e[5]=a=>s.createdAt=a),"default-value":new Date,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","default-value"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{class:"flex",label:"缩略图"},{default:t(()=>[l(X,{class:"avatar-uploader","http-request":we,"show-file-list":!1,"before-upload":ye},{default:t(()=>[l(W,{placement:"top-start",title:"上传",width:200,trigger:"hover",content:"上传图片作为封面图，大小200k内"},{reference:t(()=>[l(I,{class:"avatar-uploader-icon"},{default:t(()=>[l(Pe)]),_:1})]),_:1})]),_:1}),s.img?(d(),c(W,{key:0,placement:"right",width:400,trigger:"hover"},{reference:t(()=>[l(E,{class:"avatar-uploader-icon pointer ml-10",src:s.img},null,8,["src"])]),default:t(()=>[l(E,{style:{width:"100%"},src:s.img},null,8,["src"])]),_:1})):P("",!0),l(Y,{type:"primary",class:"ml-10",onClick:e[6]||(e[6]=a=>N.value=!0)},{default:t(()=>e[28]||(e[28]=[_(" 默认封面图 ")])),_:1}),l(Se,{modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=a=>N.value=a),title:"默认封面图",class:"w-300","with-header":!1},{default:t(()=>[w("div",Dl,[(d(!0),V(k,null,U(pe.value,(a,D)=>(d(),c(E,{key:D,src:a,onClick:r=>Ve(a),fit:"cover"},null,8,["src","onClick"]))),128))])]),_:1},8,["modelValue"]),l(v,{class:"ml-10 flex-1",modelValue:s.img,"onUpdate:modelValue":e[8]||(e[8]=a=>s.img=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(n,{label:"内容摘要"},{default:t(()=>[l(v,{type:"textarea",rows:2,placeholder:"请输入内容",modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=a=>s.description=a)},null,8,["modelValue"])]),_:1}),l(n,{label:"文章内容"},{default:t(()=>[l(yl,{modelValue:s.content,"onUpdate:modelValue":e[10]||(e[10]=a=>s.content=a),setting:ne,onInit:ge,"script-src":"/public/admin/tinymce/tinymce.min.js"},null,8,["modelValue","setting"])]),_:1}),l(j,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(n,{label:"自动封面"},{default:t(()=>[l(y,{modelValue:S.value,"onUpdate:modelValue":e[12]||(e[12]=a=>S.value=a)},{default:t(()=>[e[29]||(e[29]=_(" 文章第 ")),l(v,{modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=a=>z.value=a),class:"w-80 mr-8 ml-8",placeholder:"请输入内容"},null,8,["modelValue"]),e[30]||(e[30]=_("张图 "))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(n,{label:"提取描述"},{default:t(()=>[l(y,{modelValue:R.value,"onUpdate:modelValue":e[13]||(e[13]=a=>R.value=a)},{default:t(()=>e[31]||(e[31]=[_("提取文章描述")])),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(n,{label:"是否显示"},{default:t(()=>[l(B,{modelValue:s.status,"onUpdate:modelValue":e[14]||(e[14]=a=>s.status=a),value:"0"},{default:t(()=>e[32]||(e[32]=[_("发布")])),_:1},8,["modelValue"]),l(B,{modelValue:s.status,"onUpdate:modelValue":e[15]||(e[15]=a=>s.status=a),value:"1"},{default:t(()=>e[33]||(e[33]=[_("不发布")])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])),[[F,x.value==0],[Fe,M.value]]),O(w("div",null,[l(j,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"短标题",prop:"name"},{default:t(()=>[l(v,{modelValue:s.shortTitle,"onUpdate:modelValue":e[16]||(e[16]=a=>s.shortTitle=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"内容模板"},{default:t(()=>[l(le,{modelValue:s.articleView,"onUpdate:modelValue":e[17]||(e[17]=a=>s.articleView=a),placeholder:"请选择模板"},{default:t(()=>[(d(!0),V(k,null,U(G.value,a=>(d(),c(ee,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"来源"},{default:t(()=>[l(v,{modelValue:s.source,"onUpdate:modelValue":e[18]||(e[18]=a=>s.source=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"作者"},{default:t(()=>[l(v,{modelValue:s.author,"onUpdate:modelValue":e[19]||(e[19]=a=>s.author=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"外链跳转"},{default:t(()=>[l(v,{modelValue:s.link,"onUpdate:modelValue":e[20]||(e[20]=a=>s.link=a),max:"120"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(n,{label:"浏览数"},{default:t(()=>[l(v,{modelValue:s.pv,"onUpdate:modelValue":e[21]||(e[21]=a=>s.pv=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})],512),[[F,x.value==1]]),O(w("div",null,[l(j,{gutter:20},{default:t(()=>[(d(!0),V(k,null,U(g.value,(a,D)=>(d(),c(i,{key:D,sm:24,md:24,lg:24},{default:t(()=>[["1","7"].includes(a.type)?(d(),c(n,{key:0,label:a.cname},{default:t(()=>[l(v,{modelValue:a.values,"onUpdate:modelValue":r=>a.values=r,max:"120"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["2","9"].includes(a.type)?(d(),c(n,{key:1,label:a.cname},{default:t(()=>[l(v,{type:"textarea",rows:4,placeholder:"请输入内容",modelValue:a.values,"onUpdate:modelValue":r=>a.values=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["4"].includes(a.type)?(d(),c(n,{key:2,label:a.cname},{default:t(()=>[l(Re,{modelValue:a.values,"onUpdate:modelValue":r=>a.values=r},{default:t(()=>[(d(!0),V(k,null,U(a.defaultVal,r=>(d(),c(B,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["3","5"].includes(a.type)?(d(),c(n,{key:3,label:a.cname},{default:t(()=>[l(le,{modelValue:a.values,"onUpdate:modelValue":r=>a.values=r,placeholder:"请选择"},{default:t(()=>[(d(!0),V(k,null,U(a.defaultVal,r=>(d(),c(ee,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):a.type==="6"?(d(),c(n,{key:4,label:a.cname},{default:t(()=>[l(Q,{modelValue:a.values,"onUpdate:modelValue":r=>a.values=r,"default-value":new Date,type:"datetime",placeholder:"请选择"},null,8,["modelValue","onUpdate:modelValue","default-value"])]),_:2},1032,["label"])):a.type==="8"?(d(),c(n,{key:5,label:a.cname,class:"flex align-c justify-center"},{default:t(()=>{var r;return[((r=a==null?void 0:a.values)==null?void 0:r.length)>0?(d(),V("div",Al,[(d(!0),V(k,null,U(a.values,(C,ae)=>(d(),V("div",{class:"pos-r img-item",key:ae},[(d(),c(E,{key:ae,src:C.url,fit:"cover"},null,8,["src"])),w("div",Pl,[l(I,{onClick:Me=>Ee(C)},{default:t(()=>[l(Te)]),_:2},1032,["onClick"]),l(I,{onClick:Me=>Ce(C)},{default:t(()=>[l(Le)]),_:2},1032,["onClick"])])]))),128))])):P("",!0),l(Ne,{modelValue:L.value,"onUpdate:modelValue":e[22]||(e[22]=C=>L.value=C)},{default:t(()=>[l(E,{"w-full":"",src:Z.value,alt:"Preview Image"},null,8,["src"])]),_:1},8,["modelValue"]),l(X,{multiple:"","http-request":Ue,data:{...a,index:D},"before-upload":ke,limit:10,"show-file-list":!1},{default:t(()=>[l(I,{class:"upload-icon"},{default:t(()=>[l(Be)]),_:1})]),_:2},1032,["data"])]}),_:2},1032,["label"])):P("",!0)]),_:2},1024))),128))]),_:1})],512),[[F,x.value==2&g.value.length>0]]),l(n,null,{default:t(()=>[l(Y,{type:"primary",onClick:e[23]||(e[23]=a=>je(J.value))},{default:t(()=>e[34]||(e[34]=[_("保存")])),_:1})]),_:1})]),_:1},8,["model"])])])}}},sa=wl(Sl,[["__scopeId","data-v-ea353216"]]);export{sa as default};
