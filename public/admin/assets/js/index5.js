var R=Object.defineProperty;var j=(n,e,i)=>e in n?R(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var h=(n,e,i)=>j(n,typeof e!="symbol"?e+"":e,i);import{q,r as B,s as N,f as D,t as v}from"./element-plus.js";import{W as P,r as E,n as M,c as K,a as d,V as a,L as f,af as O,u as z,I as G,o as H,a3 as W}from"./@vue.js";import{u as J,a as Q}from"./vue-router.js";import{M as X}from"./vue3-puzzle-vcode.js";import{A as _,h as l,_ as Y,u as Z,s as V}from"./index.js";import{g as ee,d as te,c as oe}from"./login_log.js";import"./js-cookie.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./nprogress.js";/* empty css     */const s=class s{version(){return"v.1.0"}static get(e={}){return l({url:"".concat(s.API,"/cms/get"),method:"GET",params:e,withCredentials:!1})}static post(e={}){return l({url:"".concat(s.API,"/cms/post"),method:"POST",data:e})}static put(e={}){return l({url:"".concat(s.API,"/cms/put"),method:"PUT",data:e})}static patch(e={}){return l({url:"".concat(s.API,"/cms/patch"),method:"PATCH",data:e})}static delete(){return l({url:"".concat(s.API,"/cms/delete?id=1"),method:"Delete"})}};h(s,"API",_.BASE_API),h(s,"upload",e=>l({url:"".concat(s.API,"/cms/delete?id=1"),method:"post",headers:{"Content-type":"multipart/form-data"},data:e}));let I=s;class S extends I{constructor(e){super(e)}static toLogin(e){return l({url:"".concat(_.BASE_API,"/base/user/login"),method:"post",data:e})}static userInfo(){return l({url:"".concat(_.BASE_API,"/base/user/detail"),method:"get"})}static menuList(){return new Promise((e,i)=>{setTimeout(()=>{let p=asyncRoutes;e({code:200,data:p})},300)})}}const se={class:"flex"},re={class:"login-wrap flex justify-center items-center flex-col flex-1"},ae={class:"login flex flex-col justify-center items-center w-full"},le={__name:"index",setup(n){const e=J(),i=Q(),p=Z(),u=P({username:"",password:""}),g=E(!1),b=P({ip:"",country:"",prov:"",city:"",district:"",isp:"",lat:"",lng:""}),k=["/public/cover/sea/01.png","/public/cover/sea/02.png","/public/cover/sea/03.png","/public/cover/sea/04.png","/public/cover/sea/05.png","/public/cover/sea/06.png","/public/cover/sea/07.png"],x=E(null),$=()=>{L()},C=t=>{console.log(t)},A=async()=>{x.value.validate(t=>{if(t)g.value=!0;else return!1})},L=async()=>{try{const{username:t,password:o}=u,r=await S.toLogin({username:t,password:o});if(r.code==200){const{token:c}=r.data;p.setToken(c),await T()}else r.code===201&&(v({title:"提示",message:r.msg||"登录失败",type:"warning"}),g.value=!1)}catch(t){console.log(t)}},T=async()=>{try{const t=await S.userInfo();if(t.code===200){let o=t.data;if(!(o!=null&&o.role)){v({title:"提示",message:"您没有角色，请联系管理员",duration:3e3,type:"error"}),p.logout(),g.value=!1;return}p.setUserInfo(o),v({title:"提示",message:"登录成功",duration:900,type:"success"}),await te(),await oe(b),e.push(i.query.redirect||"/")}}catch(t){console.log(t)}},F=async()=>{try{let t=await ee();if(t.code==="Success"){const{country:o,prov:r,district:c,city:w,isp:y,lat:m,lng:U}=t.data;Object.assign(b,{ip:t.ip||"localhost",country:o,prov:r,city:w,district:c,isp:y,lat:m,lng:U}),V("ip",t.ip),V("city",w)}}catch(t){console.log(t)}};return M(()=>{F()}),(t,o)=>{const r=N,c=B,w=D,y=q;return H(),K(G,null,[d("div",se,[o[4]||(o[4]=d("div",{class:"login-bg pd-20 flex flex-col"},null,-1)),d("div",re,[d("div",ae,[o[3]||(o[3]=d("h1",null,"CFD",-1)),a(y,{class:"mt-20 login-form",model:u,ref_key:"formRef",ref:x,"label-width":"70px",onKeyup:O(A,["enter"])},{default:f(()=>[a(c,{label:"用户名",prop:"username","label-position":"left",rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]},{default:f(()=>[a(r,{modelValue:u.username,"onUpdate:modelValue":o[0]||(o[0]=m=>u.username=m),placeholder:"请输入用户名","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),a(c,{label:"密码",prop:"password","label-position":"left",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},{default:f(()=>[a(r,{type:"password",modelValue:u.password,"onUpdate:modelValue":o[1]||(o[1]=m=>u.password=m),placeholder:"请输入密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),a(c,null,{default:f(()=>[a(w,{class:"w-full",type:"primary",size:"large",onClick:A},{default:f(()=>[...o[2]||(o[2]=[W(" 登录 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])]),a(z(X),{imgs:k,show:g.value,onSuccess:$,onFail:C},null,8,["show"])],64)}}},ke=Y(le,[["__scopeId","data-v-8976c62e"]]);export{ke as default};
