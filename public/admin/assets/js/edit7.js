import{r as F,s as I,g as L,N as M,B as T,C as j,V as H,q as O,a as p}from"./element-plus.js";import{a as S,u as z}from"./vue-router.js";import{f as P}from"./category.js";import{d as A,g as G,u as K}from"./gather.js";import{_ as Q,d as W,a as J,t as X}from"./index.js";import{r as c,W as V,n as Y,c as Z,o as b,O as a,L as s,K as $,H as ee,a as d,a3 as i,Q as te}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const ae={class:"mb-20 bg-fff pd-20"},le={class:"flex w-full"},se={class:"flex w-full"},re={class:"f-15"},oe=["innerHTML"],ne={__name:"edit",setup(de){const v=S(),w=z(),f=c(null),l=V({id:v.params.id,taskName:"",targetUrl:"",parseData:"",status:"1",cid:1}),m=c([]),k={checkStrictly:!0},g=c([]),u=V({title:"",article:""});async function x(){try{let e=await P();if(e.code===200){let t=e.data,n=W(l.cid,t);m.value=n;let r=J(X(t));g.value=[...r]}}catch(e){console.log(e)}}function C(e){e.length&&e[e.length-1]!=-1&&(l.cid=e[e.length-1])}async function E(){try{let e=await A(l.id);e.code===200&&Object.assign(l,e.data)}catch(e){console.error(e)}}async function U(){try{let{targetUrl:e,parseData:t}=l,n=await G({targetUrl:e,parseData:t});n.code==200&&(Object.assign(u,n.data),p({message:"恭喜你，获取数据成功^_^",type:"success"}))}catch(e){console.log(e)}}async function N(){try{let e=await K(l);e.code==200?(p({message:"更新成功^_^",type:"success"}),w.go(-1)):p({message:e.msg,type:"error"})}catch(e){console.log(e)}}function B(){f.value.validate(e=>{if(e)N();else return!1})}return Y(async()=>{await E(),await x()}),(e,t)=>{const n=I,r=F,_=L,D=M,y=j,q=T,R=H,h=O;return b(),Z("div",ae,[a(h,{ref_key:"formRef",ref:f,model:l,"label-width":"84px"},{default:s(()=>[a(r,{label:"任务名称",prop:"taskName",rules:[{required:!0,message:"请输入任务名称",trigger:"blur"}]},{default:s(()=>[a(n,{modelValue:l.taskName,"onUpdate:modelValue":t[0]||(t[0]=o=>l.taskName=o),placeholder:"例：前端库-chat问答"},null,8,["modelValue"])]),_:1}),a(r,{label:"接口地址",prop:"targetUrl",rules:[{required:!0,message:"请输入匹配网址",trigger:"blur"}]},{default:s(()=>[d("div",le,[a(n,{class:"flex-1",modelValue:l.targetUrl,"onUpdate:modelValue":t[1]||(t[1]=o=>l.targetUrl=o)},null,8,["modelValue"])])]),_:1}),a(r,{label:"处理函数",prop:"parseData",rules:[{required:!0,message:"请输入内容字段",trigger:"blur"}]},{default:s(()=>[d("div",se,[a(n,{class:"flex-1",type:"textarea",rows:13,modelValue:l.parseData,"onUpdate:modelValue":t[2]||(t[2]=o=>l.parseData=o),placeholder:"如果不做任何处理，直接返回data。拿到的文本是变量是data,可以直接js函数可以处理成需要的数据，最终需要返回data。例：\n            data.title = data.title;\n            data.article = data.data.news;\n            return data;\n            "},null,8,["modelValue"]),a(_,{class:"ml-5",type:"primary",onClick:U},{default:s(()=>t[5]||(t[5]=[i("测试")])),_:1})])]),_:1}),a(r,{label:"保存栏目",prop:"cid",rules:[{required:!0,message:"请输入保存栏目",trigger:"blur"}]},{default:s(()=>[a(D,{props:k,"show-all-levels":!1,modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=o=>m.value=o),options:g.value,onChange:C},null,8,["modelValue","options"])]),_:1}),a(r,{label:"发布状态",prop:"status",rules:[{required:!0,message:"请选择发布状态",trigger:"blur"}]},{default:s(()=>[a(q,{modelValue:l.status,"onUpdate:modelValue":t[4]||(t[4]=o=>l.status=o),class:"ml-4"},{default:s(()=>[a(y,{value:"1",size:"large"},{default:s(()=>t[6]||(t[6]=[i("草稿")])),_:1}),a(y,{value:"2",size:"large"},{default:s(()=>t[7]||(t[7]=[i("发布")])),_:1})]),_:1},8,["modelValue"])]),_:1}),u.title?(b(),$(r,{key:0,label:"采集结果"},{default:s(()=>[a(R,{class:"w-full",shadow:"never"},{header:s(()=>[d("p",re,[t[8]||(t[8]=d("span",{class:"c-999"},"标题：",-1)),i(te(u.title),1)])]),default:s(()=>[t[9]||(t[9]=d("p",{class:"f-15"},[d("span",{class:"c-999"},"内容：")],-1)),d("div",{class:"f-15 article",innerHTML:u.content},null,8,oe)]),_:1})]),_:1})):ee("",!0),a(r,null,{default:s(()=>[a(_,{type:"primary",onClick:B},{default:s(()=>t[10]||(t[10]=[i("保存")])),_:1})]),_:1})]),_:1},8,["model"])])}}},qe=Q(ne,[["__scopeId","data-v-9da430e4"]]);export{qe as default};
