import{n as oe,m as se,r as ue,N as ne,s as de,L as re,M as ie,C as me,B as pe,w as fe,b as ve,g as Ve,q as ce,A as ye,a as c}from"./element-plus.js";import{r as n,W as ge,n as be,ab as _e,c as _,o as f,a as y,O as t,L as s,T as B,I as k,ac as C,K as S,a3 as i,U as T,H as we,Q as Ue}from"./@vue.js";import{a as Ee,u as xe}from"./vue-router.js";import{f as Be,a as ke,u as Ce}from"./category.js";import{s as Se}from"./article.js";import{d as Te,a as Ie,t as Le}from"./index.js";import{l as Fe}from"./model.js";import{v as Ne}from"./sys_config.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const Re={class:"bg-fff radius-6 pd-20"},De={class:"mr-10 ml-10"},Oe={class:"mr-10 ml-10 mb-20"},nl={__name:"edit",setup(Pe){const P=Ee(),j=xe(),w=n(P.params.id),m=n([]),v=n(""),A={checkStrictly:!0},I=n("first"),g=n("0"),K=n(null),U=n([]),L=n([{id:-1,label:"顶级栏目"}]),E=n([]),F=n(!1),x=n([]),N=n(""),a=ge({pid:0,seoTitle:"",seoKeywords:"",seoDescription:"",name:"",path:"",pinyin:"",mid:"0",description:"",url:"",orderBy:0,type:"0",target:"0",status:"0",articleView:"",listView:""}),M=o=>{a.path=v.value?v.value+o:"/"+v.value+o},q=o=>{g.value=o.index},Q=async()=>{try{let o=await Se(1,"",w.value);o.code==200&&(F.value=o.data.count>0)}catch(o){console.log(o)}},z=async()=>{try{let o=await Be();if(o.code===200){let e=o.data;U.value=e;let d=Te(w.value,e);d.length<1?m.value=[-1]:m.value=[...d],m.value.length>0&&m.value.pop(),m.value.length==0&&(m.value=[-1]);let V=Ie(Le(e));L.value=[{id:0,label:"顶级栏目",value:-1},...V]}}catch(o){console.log(o)}},Z=async()=>{try{let o=await Ne();o.code===200&&(x.value=o.data.filter(e=>{if(e!=="404.html"&&e!=="500.html")return!0}).map(e=>({label:e,value:e})))}catch(o){console.log(o)}},$=async()=>{try{let o=await Fe();o.code===200&&(E.value=o.data.list.map(e=>(e.id=e.id.toString(),e)))}catch(o){console.log(o)}},G=async()=>{try{let o=await ke(w.value);if(o.code===200){N.value=o.data.path,Object.assign(a,o.data);let e=[];U.value.forEach(d=>{d.id==o.data.pid&&e.push("/"+d.pinyin)}),v.value=e.join("")+"/"}}catch(o){console.error(o)}},H=o=>{let e=[];Object.values(o).forEach(V=>{U.value.forEach(b=>{b.id==V&&e.push("/"+b.pinyin)})}),v.value=e.join("")+"/",a.path=v.value+a.pinyin,o[0]!=-1&&(a.pid=o[o.length-1])},W=async()=>a.pinyin=="article"?(c({message:"不能使用article作为路径",type:"success"}),!1):/^[a-zA-Z][a-zA-Z0-9]*$/.test(a.pinyin)?!0:(c({message:"拼音只能包含26个字母和数字，且首字母不能是数字",type:"success"}),!1),R=async()=>{try{let o=await Ce(a);o.code?(c({message:"更新成功^_^",type:"success"}),j.go(-1)):c({message:o.msg,type:"success"})}catch(o){console.log(o)}},h=()=>{N.value!=a.path?ye.confirm("栏目路径已修改，若有子栏目请同步修改！！！","温馨提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{W()&&R()}).catch(()=>{c({type:"info",message:"操作取消成功！"})}):R()};return be(()=>{$(),z(),G(),Q(),Z()}),(o,e)=>{const d=oe,V=se,b=ne,u=ue,r=de,D=ie,O=re,p=me,J=pe,X=_e("QuestionFilled"),Y=ve,ee=fe,le=Ve,ae=ce;return f(),_("div",Re,[y("div",De,[t(V,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=l=>I.value=l),onTabClick:q},{default:s(()=>[t(d,{label:"基本信息",name:"first"}),t(d,{label:"SEO设置",name:"second"}),t(d,{label:"扩展信息",name:"third"})]),_:1},8,["modelValue"])]),y("div",Oe,[t(ae,{ref_key:"paramsRef",ref:K,model:a,"label-width":"84px",class:"w640"},{default:s(()=>[B(y("div",null,[t(u,{label:"上级栏目"},{default:s(()=>[t(b,{props:A,disabled:!0,"show-all-levels":!1,modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),options:L.value,onChange:H,placeholder:"不选择为顶级栏目"},null,8,["modelValue","options"])]),_:1}),t(u,{label:"栏目名称",prop:"name",rules:[{required:!0,message:"请输入栏目名称",trigger:"blur"},{min:1,max:50,message:"栏目不能超过50个字",trigger:"blur"}]},{default:s(()=>[t(r,{modelValue:a.name,"onUpdate:modelValue":e[2]||(e[2]=l=>a.name=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"栏目标识"},{default:s(()=>[t(r,{modelValue:a.pinyin,"onUpdate:modelValue":e[3]||(e[3]=l=>a.pinyin=l),disabled:!0,onChange:M,placeholder:"注：首页请填写home"},null,8,["modelValue"])]),_:1}),t(u,{label:"栏目路径"},{default:s(()=>[t(r,{modelValue:a.path,"onUpdate:modelValue":e[4]||(e[4]=l=>a.path=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(u,{label:"列表模板"},{default:s(()=>[t(O,{modelValue:a.listView,"onUpdate:modelValue":e[5]||(e[5]=l=>a.listView=l),placeholder:"Select"},{default:s(()=>[(f(!0),_(k,null,C(x.value,l=>(f(),S(D,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"内容模板"},{default:s(()=>[t(O,{modelValue:a.articleView,"onUpdate:modelValue":e[6]||(e[6]=l=>a.articleView=l),placeholder:"Select"},{default:s(()=>[(f(!0),_(k,null,C(x.value,l=>(f(),S(D,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"栏目类型"},{default:s(()=>[t(p,{modelValue:a.type,"onUpdate:modelValue":e[7]||(e[7]=l=>a.type=l),value:"0"},{default:s(()=>e[21]||(e[21]=[i("栏目")])),_:1},8,["modelValue"]),t(p,{modelValue:a.type,"onUpdate:modelValue":e[8]||(e[8]=l=>a.type=l),value:"1"},{default:s(()=>e[22]||(e[22]=[i("单页")])),_:1},8,["modelValue"])]),_:1}),t(u,{label:"是否显示"},{default:s(()=>[t(p,{modelValue:a.status,"onUpdate:modelValue":e[9]||(e[9]=l=>a.status=l),value:"0"},{default:s(()=>e[23]||(e[23]=[i("显示")])),_:1},8,["modelValue"]),t(p,{modelValue:a.status,"onUpdate:modelValue":e[10]||(e[10]=l=>a.status=l),value:"1"},{default:s(()=>e[24]||(e[24]=[i("隐藏")])),_:1},8,["modelValue"])]),_:1})],512),[[T,g.value==0]]),B(y("div",null,[t(u,{label:"seo标题"},{default:s(()=>[t(r,{modelValue:a.seoTitle,"onUpdate:modelValue":e[11]||(e[11]=l=>a.seoTitle=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"seo关键词"},{default:s(()=>[t(r,{modelValue:a.seoKeywords,"onUpdate:modelValue":e[12]||(e[12]=l=>a.seoKeywords=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"seo描述"},{default:s(()=>[t(r,{type:"textarea",prop:"textarea",rows:2,modelValue:a.seoDescription,"onUpdate:modelValue":e[13]||(e[13]=l=>a.seoDescription=l)},null,8,["modelValue"])]),_:1})],512),[[T,g.value==1]]),B(y("div",null,[t(u,{label:"栏目链接"},{default:s(()=>[t(r,{modelValue:a.url,"onUpdate:modelValue":e[14]||(e[14]=l=>a.url=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"扩展模型"},{default:s(()=>[t(J,{modelValue:a.mid,"onUpdate:modelValue":e[15]||(e[15]=l=>a.mid=l)},{default:s(()=>[t(p,{value:"0"},{default:s(()=>e[25]||(e[25]=[i("基本模型")])),_:1}),E.value.length>0?(f(!0),_(k,{key:0},C(E.value,(l,te)=>(f(),S(p,{disabled:F.value,key:te,value:l.id},{default:s(()=>[i(Ue(l.model)+"模型 ",1)]),_:2},1032,["disabled","value"]))),128)):we("",!0)]),_:1},8,["modelValue"]),t(ee,{content:"如果栏目已经存在文章，则不能更换模型",effect:"light",placement:"top-start"},{default:s(()=>[t(Y,{class:"ml-20 pointer"},{default:s(()=>[t(X,{class:"c-165dff"})]),_:1})]),_:1})]),_:1}),t(u,{label:"打开方式"},{default:s(()=>[t(p,{modelValue:a.target,"onUpdate:modelValue":e[16]||(e[16]=l=>a.target=l),value:"0"},{default:s(()=>e[26]||(e[26]=[i("当前页面")])),_:1},8,["modelValue"]),t(p,{modelValue:a.target,"onUpdate:modelValue":e[17]||(e[17]=l=>a.target=l),value:"1"},{default:s(()=>e[27]||(e[27]=[i("新页面")])),_:1},8,["modelValue"])]),_:1}),t(u,{label:"栏目排序"},{default:s(()=>[t(r,{modelValue:a.orderBy,"onUpdate:modelValue":e[18]||(e[18]=l=>a.orderBy=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"栏目描述"},{default:s(()=>[t(r,{type:"textarea",prop:"textarea",rows:2,modelValue:a.description,"onUpdate:modelValue":e[19]||(e[19]=l=>a.description=l)},null,8,["modelValue"])]),_:1})],512),[[T,g.value==2]]),t(u,null,{default:s(()=>[t(le,{type:"primary",onClick:e[20]||(e[20]=l=>h("params"))},{default:s(()=>e[28]||(e[28]=[i("保存")])),_:1})]),_:1})]),_:1},8,["model"])])])}}};export{nl as default};
