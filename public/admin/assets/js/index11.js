import{g as j,u as F,v as H,x as L,y as U,a as _}from"./element-plus.js";import{u as V}from"./vue-router.js";import{H as q,F as z,J as G}from"./@element-plus.js";import{l as D,b as J,a as K}from"./collect.js";import{c as O}from"./article.js";import{f as Q}from"./index.js";import{r as p,W,n as X,ab as Y,aq as Z,c as tt,o as E,O as a,L as n,a3 as m,Q as v,T as h,u as b,K as et}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const at={class:"bg-fff radius-6 pd-20"},xt={__name:"index",setup(ot){const A=V(),S=p(null),w=p([]),B=p([]),C=p(0),k=p(1),l=p(0),i=W({cid:0,title:"",shortTitle:"",tagId:"",attr:[],source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用ChanCMS系统",status:"0",pv:1,link:""}),T=async()=>{try{const e=await D(k.value);e.code===200&&(w.value=[...e.data.list],C.value=e.data.count)}catch(e){console.log(e)}},$=e=>{k.value=e,D()},I=e=>{B.value=e},x=async e=>{try{const{pages:t,titleTag:o,articleTag:d,parseData:c,charset:r,cid:g,status:y}=e,u=t.split(","),s=await K({taskUrl:u[l.value],titleTag:o,articleTag:d,parseData:c,charset:r});if(s.code===200){const{title:f,article:R}=s.data;i.title=f,i.content=R,i.cid=g,i.status=y===1?1:0,M(i)}}catch(t){console.log(t)}},M=async e=>{try{const t={...i};t.attr=t.attr.toString(),t.tagId=t.tagId.toString(),!t.description&&t.content&&(t.description=Q(t.content).substr(0,255));const o=await O({defaultParams:t,fieldParams:{}});o.code===200?(_({message:"第".concat(l.value+1,"条数据完成^_^"),type:"success"}),setTimeout(()=>{const{pages:d}=e,c=d.split(",");l.value<=c.length-1&&(x(e),l.value=l.value+1)},3e3)):_({message:o.msg||"第".concat(l.value+1,"条数据失败^_^"),type:"error"})}catch(t){console.log(t)}},N=e=>{const t=e.id;A.push({name:"collect-edit",params:{id:t}})},P=async e=>{const t=e.id;try{const o=await J(t);o.code===200?(_({message:"删除成功 ^_^",type:"success"}),T()):_({message:o.msg,type:"error"})}catch(o){console.log(o)}};return X(()=>{T()}),(e,t)=>{const o=j,d=Y("router-link"),c=F,r=H,g=L,y=U,u=Z("permission-disabled");return E(),tt("div",at,[a(c,{type:"flex",justify:"end"},{default:n(()=>[a(d,{to:"/collect/add"},{default:n(()=>[a(o,{type:"primary",round:""},{default:n(()=>t[0]||(t[0]=[m("新增")])),_:1})]),_:1})]),_:1}),a(g,{ref_key:"multipleTable",ref:S,data:w.value,"tooltip-effect":"dark","row-key":"id",onSelectionChange:I},{default:n(()=>[a(r,{type:"selection"}),a(r,{prop:"id",width:"60",label:"编号"}),a(r,{prop:"taskName",label:"任务名称"}),a(r,{prop:"category",label:"所属栏目"}),a(r,{prop:"charset",label:"编码"},{default:n(s=>[m(v(s.row.charset===1?"UTF-8":"GB2312"),1)]),_:1}),a(r,{prop:"status",label:"状态"},{default:n(s=>[m(v(s.row.status===1?"草稿":"发布"),1)]),_:1}),a(r,{prop:"updatedAt",label:"发布时间"},{default:n(s=>[m(v(s.row.updatedAt),1)]),_:1}),a(r,{fixed:"right",width:"222",label:"操作"},{default:n(s=>[h(a(o,{icon:b(q),circle:"",onClick:f=>N(s.row)},null,8,["icon","onClick"]),[[u,["editor","admin","super"]]]),h(a(o,{icon:b(z),circle:"",onClick:f=>P(s.row)},null,8,["icon","onClick"]),[[u,["editor","admin","super"]]]),h((E(),et(o,{type:"primary",round:"",icon:b(G),onClick:f=>x(s.row)},{default:n(()=>t[1]||(t[1]=[m("执行")])),_:2},1032,["icon","onClick"])),[[u,["editor","admin","super"]]])]),_:1})]),_:1},8,["data"]),a(c,{type:"flex",class:"mt-20 align-c",justify:"center"},{default:n(()=>[a(y,{background:"",layout:"prev, pager, next",onCurrentChange:$,"page-size":10,total:C.value,"hide-on-single-page":""},null,8,["total"])]),_:1})])}}};export{xt as default};
