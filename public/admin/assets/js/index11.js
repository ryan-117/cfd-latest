import{f as V,u as F,v as H,x as L,y as M,E as _}from"./element-plus.js";import{u as U}from"./vue-router.js";import{H as z,F as G,J}from"./@element-plus.js";import{l as E,b as K,a as W}from"./collect.js";import{c as q}from"./article.js";import{f as O}from"./index.js";import{r as p,W as Q,n as X,aj as Y,ar as Z,c as tt,o as D,V as a,L as n,a3 as m,P as v,S as h,u as b,K as et}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const at={class:"bg-fff radius-6 pd-20"},Tt={__name:"index",setup(ot){const A=U(),S=p(null),w=p([]),B=p([]),k=p(0),C=p(1),l=p(0),i=Q({cid:0,title:"",shortTitle:"",tagId:"",attr:[],source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用",status:"0",pv:1,link:""}),x=async()=>{try{const e=await E(C.value);e.code===200&&(w.value=[...e.data.list],k.value=e.data.count)}catch(e){console.log(e)}},$=e=>{C.value=e,E()},P=e=>{B.value=e},T=async e=>{try{const{pages:t,titleTag:o,articleTag:d,parseData:c,charset:r,cid:g,status:y}=e,u=t.split(","),s=await W({taskUrl:u[l.value],titleTag:o,articleTag:d,parseData:c,charset:r});if(s.code===200){const{title:f,article:R}=s.data;i.title=f,i.content=R,i.cid=g,i.status=y===1?1:0,j(i)}}catch(t){console.log(t)}},j=async e=>{try{const t={...i};t.attr=t.attr.toString(),t.tagId=t.tagId.toString(),!t.description&&t.content&&(t.description=O(t.content).substr(0,255));const o=await q({defaultParams:t,fieldParams:{}});o.code===200?(_({message:"第".concat(l.value+1,"条数据完成^_^"),type:"success"}),setTimeout(()=>{const{pages:d}=e,c=d.split(",");l.value<=c.length-1&&(T(e),l.value=l.value+1)},3e3)):_({message:o.msg||"第".concat(l.value+1,"条数据失败^_^"),type:"error"})}catch(t){console.log(t)}},I=e=>{const t=e.id;A.push({name:"collect-edit",params:{id:t}})},N=async e=>{const t=e.id;try{const o=await K(t);o.code===200?(_({message:"删除成功 ^_^",type:"success"}),x()):_({message:o.msg,type:"error"})}catch(o){console.log(o)}};return X(()=>{x()}),(e,t)=>{const o=V,d=Y("router-link"),c=F,r=H,g=L,y=M,u=Z("permission-disabled");return D(),tt("div",at,[a(c,{type:"flex",justify:"end"},{default:n(()=>[a(d,{to:"/collect/add"},{default:n(()=>[a(o,{type:"primary",round:""},{default:n(()=>[...t[0]||(t[0]=[m("新增",-1)])]),_:1})]),_:1})]),_:1}),a(g,{ref_key:"multipleTable",ref:S,data:w.value,"tooltip-effect":"dark","row-key":"id",onSelectionChange:P},{default:n(()=>[a(r,{type:"selection"}),a(r,{prop:"id",width:"60",label:"编号"}),a(r,{prop:"taskName",label:"任务名称"}),a(r,{prop:"category",label:"所属栏目"}),a(r,{prop:"charset",label:"编码"},{default:n(s=>[m(v(s.row.charset===1?"UTF-8":"GB2312"),1)]),_:1}),a(r,{prop:"status",label:"状态"},{default:n(s=>[m(v(s.row.status===1?"草稿":"发布"),1)]),_:1}),a(r,{prop:"updatedAt",label:"发布时间"},{default:n(s=>[m(v(s.row.updatedAt),1)]),_:1}),a(r,{fixed:"right",width:"222",label:"操作"},{default:n(s=>[h(a(o,{icon:b(z),circle:"",onClick:f=>I(s.row)},null,8,["icon","onClick"]),[[u,["editor","admin","super"]]]),h(a(o,{icon:b(G),circle:"",onClick:f=>N(s.row)},null,8,["icon","onClick"]),[[u,["editor","admin","super"]]]),h((D(),et(o,{type:"primary",round:"",icon:b(J),onClick:f=>T(s.row)},{default:n(()=>[...t[1]||(t[1]=[m("执行",-1)])]),_:1},8,["icon","onClick"])),[[u,["editor","admin","super"]]])]),_:1})]),_:1},8,["data"]),a(c,{type:"flex",class:"mt-20 align-c",justify:"center"},{default:n(()=>[a(y,{background:"",layout:"prev, pager, next",onCurrentChange:$,"page-size":10,total:k.value,"hide-on-single-page":""},null,8,["total"])]),_:1})])}}};export{Tt as default};
