import{d as ne,n as le,W as oe,E as re,r as A,w as J,e as z,K as de,o as ce,a as n,P as G,R as w,J as T,u as h,Q as $,a0 as ue}from"./@vue.js";const he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAELklEQVRYR+2YW2wUZRTH//9vtlCoF9IoIklT3PqgPGi326hoetuaGEhIr9SgCYkkgt2WGOQVCca+GavWdr0GjD4YhG3RB3hply1LQA1tEQIxEXapGI2pEkys9LIzx2ylYWfY6e5sF0oi+7hzzvl+3/9855xvhrjNf7zN+XAHcL4Z+n8o6JWTeYt++W25S596AIZy6TB+n3yo+Nchlk8vmIIVowdXU9c3Q1gDSilBlQwjgBAYFGDvdF58/4milqvZwDpOcXWsb5Uh8hmBqkwXFMhlCN8aX5LXNbRy/T+Z+iXsHAFWRXs3QGQPyLucLDJrK5DgUXdTsxPfjAEro8E3Ce50EtxsKxPTwCPH3U2jTmJkBJgWTnAMxDeGMEoa0xQ+LJQnCD4HYFkCyAC3RdwN3U7gMkpxRTTYrMD91sCJIgCxV5R6O1Jcfy7VwonqLoj9/CqB2kF341qncGkBvRe+ureAWpRgoalCBecMFzcdK24YymZRJz5zprgq1tsJwXYL3CVZGvdGHmwZc7JQtra2gE+f712ep2QUYP714DJhaJrXLqXZQszlZwtYdSHoB9ljVk/ePVrSZFL0ZkAlxzQBVseCT8WhZhRThtFB8plk9Zi/qCi8cv0fNxvKFrDy4oF11NXXIFy2EII4iBcG3Y03VLZT8OqRd5aFPduvOEpxRayvXolxAKB2g6NgEhobBlc1HHYKY7WvHf5wtVAPgegIlbbZ9seUZ7AyFnwewi9pGoUyDmhrB931kfnC1ZwOeKlLP8GZJi6QLSFP2yep4toXSbT3ZQAfX3O6omt8Nhd9r/aHQAUMOQywYBZo5uZD2ThQ2rbPCjlnH6yI9rUryE5DU75ctJaake46Be4DuDjF8dFBNA94/AdtiySVxIlpMlTS8td801o70vMigM9huTda2lhcKHVHPO2HZv/P6LIwX7hk/+qzPSvUJGMkrg8AQYTkroRdXMlE+HH/twsG6BsOdJHYZlaO/lBZ6weOiiSXqs3Gqj0TeAxx+T75DIpgwjC0onD51pQD4JaluPrkR/cpFT9DcoVp84LOgTL/DjtBbglgou+puHwB8lEznPxJw1XSX77VtgizBvQNBw4RMqB7xt4Lc3c8lQKJaQHoO4R8ydz0/7MWoCXk8c85MrMC9J3qaafw/WtQlwXST+F3BnAeYB4obgJ1BJIuG+YtiKAjVOZ/Pd1ZdwzoG+4uBtSPpjaRbhXLcwF3hzytb2TilgVgT5BkYybBrTYC+Rvg5nRpdTRJrIs8+VPXPQXj2i4ItxC4O2NQQUQnN4U9rRcz9nH64p4ceM2lziX5Y4s3KHCdUHwE77ecMkMEp6BwhIa2Z6DslZRvfulgHafYLuCas58WLp2aLCFUga70qxOFU6dPFL2W1feYeaU43Y5z/TxnCuYabMEuC043ckdBp4pZ7f8FE5psOI1g6fwAAAAASUVORK5CYII=",pe=["width","height"],ve=["width","height"],fe=["width","height"],ge=n("div",{class:"loading-gif_"},[n("span"),n("span"),n("span"),n("span"),n("span")],-1),me=[ge],we={class:"auth-control_"},Xe={class:"range-text"},xe=n("div",null,null,-1),Te=n("div",null,null,-1),ye=n("div",null,null,-1),Ye=[xe,Te,ye],Be=ne({__name:"App",props:{type:{type:String,default:"modal"},canvasWidth:{type:Number,default:310},canvasHeight:{type:Number,default:160},show:{type:Boolean,default:!1},puzzleScale:{type:Number,default:1},sliderSize:{type:Number,default:50},range:{type:Number,default:10},zIndex:{type:Number,default:999},imgs:{type:Array,default:null},successText:{type:String,default:"验证通过！"},failText:{type:String,default:"验证失败，请重试"},sliderText:{type:String,default:"拖动滑块完成拼图"},className:{type:String,default:""}},emits:["success","fail","close","reset"],setup(o,{expose:V,emit:B}){const s=o;le(()=>{document.addEventListener("mousemove",b,!1),document.addEventListener("mouseup",C,!1),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("touchend",C,!1),a.isInside=s.type==="inside",s.show&&(!a.isInside&&document.body.classList.add("vue-puzzle-overflow"),Y())}),re(()=>{a.timer1&&clearTimeout(a.timer1),document.removeEventListener("mousemove",b,!1),document.removeEventListener("mouseup",C,!1),document.removeEventListener("touchmove",b,!1),document.removeEventListener("touchend",C,!1)});const L=A(),P=A(),R=A(),k=A(),a=oe({isInside:!1,mouseDown:!1,startWidth:50,startX:0,newX:0,pinX:0,pinY:0,loading:!1,isCanSlide:!1,error:!1,infoBoxShow:!1,infoText:"",infoBoxFail:!1,timer1:void 0,closeDown:!1,isSuccess:!1,imgIndex:-1,isSubmting:!1});J(()=>s.show,t=>{t?(!a.isInside&&document.body.classList.add("vue-puzzle-overflow"),Y()):(a.isSubmting=!1,a.isSuccess=!1,a.infoBoxShow=!1,document.body.classList.remove("vue-puzzle-overflow"))}),J(()=>s.type,t=>{t==="inside"?(a.isInside=!0,document.body.classList.remove("vue-puzzle-overflow")):a.isInside=!1});const y=z(()=>{const t=a.startWidth+a.newX-a.startX;return t<c.value?c.value:t>s.canvasWidth?s.canvasWidth:t}),d=z(()=>Math.round(Math.max(Math.min(s.puzzleScale,2),.2)*52.5+6)),c=z(()=>Math.max(Math.min(Math.round(s.sliderSize),Math.round(s.canvasWidth*.5)),10)),_=z(()=>s.zIndex!==999?"z-index:".concat(s.zIndex):""),q=()=>{!a.mouseDown&&!a.isSubmting&&(a.timer1&&clearTimeout(a.timer1),B("close"))},O=()=>{a.isInside||(a.closeDown=!0)},E=()=>{a.closeDown&&q(),a.closeDown=!1},F=t=>{var i;a.isCanSlide&&(a.mouseDown=!0,a.startWidth=((i=L.value)==null?void 0:i.clientWidth)||0,a.newX=t.clientX!==void 0?t.clientX:t.changedTouches[0].clientX,a.startX=t.clientX!==void 0?t.clientX:t.changedTouches[0].clientX)},b=t=>{a.mouseDown&&(t.preventDefault(),a.newX=t.clientX!==void 0?t.clientX:t.changedTouches[0].clientX)},C=()=>{a.mouseDown&&(a.mouseDown=!1,ee())},Q=(t=!1)=>{var i;if(a.loading&&!t)return;a.loading=!0,a.isCanSlide=!1;const r=P.value,u=R.value,p=k.value,e=r==null?void 0:r.getContext("2d",{willReadFrequently:!0}),f=u==null?void 0:u.getContext("2d"),I=p==null?void 0:p.getContext("2d");if(!e||!f||!I){console.error("not found ctx / ctx2 / ctx3");return}const te=navigator.userAgent.indexOf("Firefox")>=0&&navigator.userAgent.indexOf("Windows")>=0,g=document.createElement("img");if(e.fillStyle="rgba(255,255,255,1)",I.fillStyle="rgba(255,255,255,1)",e.clearRect(0,0,s.canvasWidth,s.canvasHeight),f.clearRect(0,0,s.canvasWidth,s.canvasHeight),a.pinX=l(d.value+20,s.canvasWidth-d.value-10),a.pinY=l(20,s.canvasHeight-d.value-10),g.crossOrigin="anonymous",g.onload=()=>{const[v,W,H,D]=j(g),Z=Math.random(),N=Math.random(),U=Math.random(),ie=Math.random(),S=Z<.33?-1:Z<.66?0:1,X=N<.33?-1:N<.66?0:1,x=U<.33?-1:U<.66?0:1;let m=ie<.6?1:0;S===X&&X===x&&x===m&&m===0&&(m=1),e.save(),M(e,S,X,x,m),e.closePath(),te?(e.clip(),e.save(),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="#000",e.shadowBlur=3,e.fill(),e.restore()):(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="#000",e.shadowBlur=3,e.fill(),e.clip()),e.drawImage(g,v,W,H,D),I.fillRect(0,0,s.canvasWidth,s.canvasHeight),I.drawImage(g,v,W,H,D),e.globalCompositeOperation="source-atop",M(e,S,X,x,m),e.arc(a.pinX+Math.ceil(d.value/2),a.pinY+Math.ceil(d.value/2),d.value*1.2,0,Math.PI*2,!0),e.closePath(),e.shadowColor="rgba(255, 255, 255, .8)",e.shadowOffsetX=-1,e.shadowOffsetY=-1,e.shadowBlur=Math.min(Math.ceil(8*s.puzzleScale),12),e.fillStyle="#ffffaa",e.fill();const se=e.getImageData(a.pinX-3,a.pinY-20,a.pinX+d.value+5,a.pinY+d.value+5);f.putImageData(se,0,a.pinY-20),e.restore(),e.clearRect(0,0,s.canvasWidth,s.canvasHeight),e.save(),M(e,S,X,x,m),e.globalAlpha=.8,e.fillStyle="#ffffff",e.fill(),e.restore(),e.save(),e.globalCompositeOperation="source-atop",M(e,S,X,x,m),e.arc(a.pinX+Math.ceil(d.value/2),a.pinY+Math.ceil(d.value/2),d.value*1.2,0,Math.PI*2,!0),e.shadowColor="#000",e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=16,e.fill(),e.restore(),e.save(),e.globalCompositeOperation="destination-over",e.drawImage(g,v,W,H,D),e.restore(),a.loading=!1,a.isCanSlide=!0},g.onerror=()=>{Q(!0)},!t&&(i=s.imgs)!=null&&i.length){let v=l(0,s.imgs.length-1);v===a.imgIndex&&(v===s.imgs.length-1?v=0:v++),a.imgIndex=v,g.src=s.imgs[v]}else g.src=K()},l=(t,i)=>Math.ceil(Math.random()*(i-t)+t),j=t=>{const i=t.width/t.height,r=s.canvasWidth/s.canvasHeight;let u=0,p=0,e=0,f=0;return i>r?(f=s.canvasHeight,e=i*f,p=0,u=(s.canvasWidth-e)/2):(e=s.canvasWidth,f=e/i,u=0,p=(s.canvasHeight-f)/2),[u,p,e,f]},M=(t,i,r,u,p)=>{const e=Math.ceil(15*s.puzzleScale);t.beginPath(),t.moveTo(a.pinX,a.pinY),t.lineTo(a.pinX+e,a.pinY),t.arcTo(a.pinX+e,a.pinY+i*e/2,a.pinX+e+e/2,a.pinY+i*e/2,e/2),t.arcTo(a.pinX+e+e,a.pinY+i*e/2,a.pinX+e+e,a.pinY,e/2),t.lineTo(a.pinX+e+e+e,a.pinY),t.lineTo(a.pinX+e+e+e,a.pinY+e),t.arcTo(a.pinX+e+e+e+r*e/2,a.pinY+e,a.pinX+e+e+e+r*e/2,a.pinY+e+e/2,e/2),t.arcTo(a.pinX+e+e+e+r*e/2,a.pinY+e+e,a.pinX+e+e+e,a.pinY+e+e,e/2),t.lineTo(a.pinX+e+e+e,a.pinY+e+e+e),t.lineTo(a.pinX+e+e,a.pinY+e+e+e),t.arcTo(a.pinX+e+e,a.pinY+e+e+e+u*e/2,a.pinX+e+e/2,a.pinY+e+e+e+u*e/2,e/2),t.arcTo(a.pinX+e,a.pinY+e+e+e+u*e/2,a.pinX+e,a.pinY+e+e+e,e/2),t.lineTo(a.pinX,a.pinY+e+e+e),t.lineTo(a.pinX,a.pinY+e+e),t.arcTo(a.pinX+p*e/2,a.pinY+e+e,a.pinX+p*e/2,a.pinY+e+e/2,e/2),t.arcTo(a.pinX+p*e/2,a.pinY+e,a.pinX,a.pinY+e,e/2),t.lineTo(a.pinX,a.pinY)},K=()=>{const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)return console.error("not found ctx"),"";t.width=s.canvasWidth,t.height=s.canvasHeight,i.fillStyle="rgb(".concat(l(100,255),",").concat(l(100,255),",").concat(l(100,255),")"),i.fillRect(0,0,s.canvasWidth,s.canvasHeight);for(let r=0;r<12;r++)if(i.fillStyle="rgb(".concat(l(100,255),",").concat(l(100,255),",").concat(l(100,255),")"),i.strokeStyle="rgb(".concat(l(100,255),",").concat(l(100,255),",").concat(l(100,255),")"),l(0,2)>1)i.save(),i.rotate(l(-90,90)*Math.PI/180),i.fillRect(l(-20,t.width-20),l(-20,t.height-20),l(10,t.width/2+10),l(10,t.height/2+10)),i.restore();else{i.beginPath();const u=l(-Math.PI,Math.PI);i.arc(l(0,t.width),l(0,t.height),l(10,t.height/2+10),u,u+Math.PI*1.5),i.closePath(),i.fill()}return t.toDataURL("image/png")},ee=()=>{a.isSubmting=!0;const t=y.value-c.value-(d.value-c.value)*((y.value-c.value)/(s.canvasWidth-c.value)),i=a.pinX-3-t;Math.abs(i)<s.range?(a.infoText=s.successText,a.infoBoxFail=!1,a.infoBoxShow=!0,a.isCanSlide=!1,a.isSuccess=!0,a.timer1&&clearTimeout(a.timer1),a.timer1=setTimeout(()=>{a.isSubmting=!1,B("success",i,{deviation:i,offsetX:t,pinX:a.pinX-3})},800)):(a.infoText=s.failText,a.infoBoxFail=!0,a.infoBoxShow=!0,a.isCanSlide=!1,B("fail",i,{deviation:i,offsetX:t,pinX:a.pinX-3}),a.timer1&&clearTimeout(a.timer1),a.timer1=setTimeout(()=>{a.isSubmting=!1,Y()},800))},ae=()=>{a.infoBoxFail=!1,a.infoBoxShow=!1,a.isCanSlide=!1,a.isSuccess=!1,a.startWidth=c.value,a.startX=0,a.newX=0},Y=t=>{a.isSubmting||(ae(),Q(),t&&B("reset"))};return V({reset:Y}),(t,i)=>(ce(),de(ue,{to:"body",disabled:a.isInside},[n("div",{class:T(["vue-puzzle-vcode",{inside_:a.isInside,show_:o.show},o.className]),style:w(h(_)),onMousedown:O,onMouseup:E,onTouchstartPassive:O,onTouchend:E},[n("div",{class:"vue-auth-box_",onMousedown:i[3]||(i[3]=G(()=>{},["stop"])),onTouchstart:i[4]||(i[4]=G(()=>{},["stop"]))},[n("div",{class:"auth-body_",style:w("width:".concat(o.canvasWidth,"px;height: ").concat(o.canvasHeight,"px"))},[n("canvas",{ref_key:"canvas1",ref:P,class:"auth-canvas1_",width:o.canvasWidth,height:o.canvasHeight},null,8,pe),n("canvas",{ref_key:"canvas3",ref:k,class:T(["auth-canvas3_",{show:a.isSuccess}]),width:o.canvasWidth,height:o.canvasHeight},null,10,ve),n("canvas",{ref_key:"canvas2",ref:R,class:"auth-canvas2_",width:h(d),height:o.canvasHeight,style:w("width:".concat(h(d),"px;height:").concat(o.canvasHeight,"px;transform:translateX(").concat(h(y)-h(c)-(h(d)-h(c))*((h(y)-h(c))/(o.canvasWidth-h(c))),"px)"))},null,12,fe),n("div",{class:T(["loading-box_",{hide_:!a.loading}])},me,2),n("div",{class:T(["info-box_",{show:a.infoBoxShow},{fail:a.infoBoxFail}])},$(a.infoText),3),n("div",{class:T(["flash_",{show:a.isSuccess}]),style:w("transform: translateX(".concat(a.isSuccess?"".concat(o.canvasWidth+o.canvasHeight*.578,"px"):"-".concat(o.canvasHeight*.578,"px"),") skew(-30deg, 0);"))},null,6),n("img",{class:"reset_",onClick:i[0]||(i[0]=r=>Y(!0)),src:he})],4),n("div",we,[n("div",{class:"range-box",style:w("height:".concat(h(c),"px;width:").concat(o.canvasWidth,"px"))},[n("div",Xe,$(o.sliderText),1),n("div",{class:"range-slider",ref_key:"rangeSlider",ref:L,style:w("width:".concat(h(y),"px"))},[n("div",{class:T(["range-btn",{isDown:a.mouseDown}]),style:w("width:".concat(h(c),"px")),onMousedown:i[1]||(i[1]=r=>F(r)),onTouchstart:i[2]||(i[2]=r=>F(r))},Ye,38)],4)],4)])],32)],38)],8,["disabled"]))}});export{Be as M};
