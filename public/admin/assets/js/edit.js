import{n as Ge,m as Je,u as ze,G as He,r as Ze,N as Ke,s as Qe,O as We,P as Xe,Q as Ye,R as el,S as ll,T as al,b as tl,U as ol,g as sl,o as ul,C as dl,I as nl,L as rl,M as il,B as ml,D as pl,q as cl,a as y}from"./element-plus.js";import{r,W as fl,n as vl,ab as A,c as V,o as n,a as U,O as l,L as t,K as c,H as N,T as $,a3 as g,I as C,ac as E,U as q}from"./@vue.js";import{u as gl,a as _l}from"./vue-router.js";import{f as Vl}from"./category.js";import{a as bl,f as yl,d as wl,u as kl}from"./article.js";import{s as Ul}from"./tag.js";import{v as Cl}from"./sys_config.js";import{t as El,_ as Il}from"./tinymce.js";import{u as oe}from"./upload.js";import{_ as xl,d as jl,a as se,t as Dl,b as Sl,c as Al,f as Nl}from"./index.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css     */const Rl={class:"bg-fff pd-10 radius-6"},Tl={class:"mr-10 ml-10"},Ll={class:"mr-10 ml-10 mb-20"},Ol={class:"cover row"},Bl={key:0,class:"cover flex align-center"},Pl={class:"imgs-btn"},hl={__name:"edit",setup(Fl){const ue=gl(),de=_l(),ne=r({...El}),R=r(!0),T=r([]),re={checkStrictly:!0},M=r("first"),x=r("0"),G=r([]),ie=r([]),J=r([]),L=r(!1),O=r(!1),z=r(1),H=r([]),B=r(),Z=r(),me=r(""),s=fl({id:0,cid:0,subCid:[],title:"",shortTitle:"",tagId:"",attr:[],articleView:"",source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"",status:"0",pv:1,link:""}),f=r([]),_=r({}),K=r(""),P=r(!1),pe=r(1),h=r(!1),ce=r(["/public/cover/01.jpg","/public/cover/02.jpg","/public/cover/03.jpg","/public/cover/04.jpg","/public/cover/05.jpg","/public/cover/06.jpg","/public/cover/07.jpg","/public/cover/08.jpg","/public/cover/09.jpg","/public/cover/10.jpg"]),fe=async()=>{try{let o=await Cl();o.code===200&&(J.value=o.data.filter(e=>e!=="404.html"&&e!=="500.html").map(e=>({label:e,value:e})))}catch(o){console.log(o)}},ve=()=>{R.value=!1},ge=o=>{x.value=o.index},_e=o=>{s.img=o},Q=async(o="")=>{try{let e=await Ul(pe.value,o,100);e.code===200&&(H.value=e.data.list.map(u=>({label:u.name,value:u.id})))}catch(e){console.log(e)}},Ve=async()=>{try{let o=await Vl();if(o.code===200){let e=o.data,u=jl(s.cid,e);T.value=u;let p=se(Dl(e));ie.value=se(e),G.value=[...p],W(s.cid)}}catch(o){console.log(o)}},be=o=>{o[0]!=-1?(s.cid=o[o.length-1],W(s.cid)):f.value=[]},W=async o=>{try{let e=await yl(o);e.code===200&&(e.data.fields.forEach(u=>{if(u.defaultVal&&u.defaultVal.includes("[{")&&u.defaultVal.includes("options")){let p=JSON.parse(u.defaultVal);u.defaultVal=p.options||[]}u.type=="8"&&(u.values=[])}),f.value=e.data.fields,f.value.forEach(u=>{var p,b,d;(b=(p=_==null?void 0:_.value)==null?void 0:p[u.ename])!=null&&b.includes("[")?u.values=JSON.parse(_.value[u.ename]):u.values=(d=_==null?void 0:_.value)==null?void 0:d[u.ename]}))}catch(e){console.log(e)}},ye=async()=>{try{let o=await bl(s.id);if(o.code===200){let e=o.data;e.attr=e.attr?e.attr.split(","):[],e.subCid=e.subCid?e.subCid.split(",").map(Number):[],e.oldTagId=e.tagId,e.tagId=e.tagId?e.tagId.split(",").map(Number):[],e.status=e.status.toString(),e.updatedAt=new Date(e.createdAt),Object.assign(s,e),_.value=e.field||{},R.value=!1}}catch(o){console.error(o)}},we=o=>{console.log("e-->",o)},ke=o=>{if(o.type.indexOf("image")===-1)return y({message:"上传文件只能是图片格式",type:"success"}),!1;B.value=o;const e=new FileReader;return e.onload=async u=>{let p;typeof u.target.result=="object"?p=window.URL.createObjectURL(new Blob([u.target.result])):p=u.target.result,me.value=p},e.readAsArrayBuffer(o),!0},Ue=async()=>{if(B.value.size/1024/1024>.2)return y({message:"上传图片必须小于200k",type:"success"}),!1;const o=new FormData;o.append("file",B.value);const e=await oe(o,"1");e.code===200&&(s.img=e.data.path)},Ce=o=>{if(o.type.indexOf("image")===-1)return y({message:"上传文件只能是图片格式",type:"success"}),!1;if(o.size/1024/1024>.2)return y({message:"上传图片必须小于200k",type:"success"}),!1},Ee=async o=>{const{data:{index:e},file:u}=o;let p=new FormData;p.append("file",u);let b=await oe(p,"2");if(b.code===200){const d=b.data.map(m=>({name:m.filename,url:m.path}));Array.isArray(f.value[e].values)?f.value[e].values.push(...d):f.value[e].values=[...d]}},Ie=o=>{K.value=o.url,P.value=!0},xe=async o=>{f.value.forEach(e=>{Array.isArray(e.values)&&e.values.forEach((u,p)=>{u.url==o.url&&(je(o.url),e.values.splice(p,1))})})},je=async o=>{try{await wl(o)}catch(e){console.log(e)}},De=async()=>{try{let o={...s};o.attr=o.attr.toString(),o.subCid=o.subCid.toString(),o.tagId=o.tagId.toString(),!o.img&&L.value&&(o.img=Al(o.content)[0]),!o.description&&O.value&&(o.description=Nl(o.content).substr(0,255)),f.value.map(u=>{_.value[u.ename]=typeof u.values=="object"?JSON.stringify(u.values):u.values});let e=await kl({...o,field:_.value});e.code===200?(y({message:"更新成功^_^",type:"success"}),ue.go(-1)):y({message:e.msg,type:"success"})}catch(o){console.log(o)}},Se=o=>{o&&o.validate((e,u)=>{if(e){if(s.cid===0){y({message:"请选择栏目^_^",type:"success"});return}De()}else return Sl(u),!1})};return vl(async()=>{s.id=de.params.id,await ye(),await Ve(),Q(),fe()}),(o,e)=>{const u=Ge,p=Je,b=Ke,d=Ze,m=He,v=Qe,Ae=We,w=Ye,Ne=Xe,X=el,Re=A("MostlyCloudy"),j=tl,Y=al,ee=ll,I=ol,le=sl,Te=ul,D=ze,F=dl,ae=il,te=rl,Le=ml,Oe=A("ZoomIn"),Be=A("Delete"),Pe=pl,he=A("Plus"),Fe=cl,$e=nl;return n(),V("div",Rl,[U("div",Tl,[l(p,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=a=>M.value=a),onTabClick:ge},{default:t(()=>[l(u,{label:"基本信息",name:"first"}),l(u,{label:"扩展信息",name:"second"}),f.value.length>0?(n(),c(u,{key:0,label:"模型信息",name:"three"})):N("",!0)]),_:1},8,["modelValue"])]),U("div",Ll,[l(Fe,{ref_key:"paramsRef",ref:Z,model:s,"label-width":"90px"},{default:t(()=>[$((n(),V("div",null,[l(D,{gutter:20},{default:t(()=>[l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"文章栏目"},{default:t(()=>[l(b,{props:re,"show-all-levels":!1,modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=a=>T.value=a),options:G.value,onChange:be},null,8,["modelValue","options"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"文章标题",prop:"title",rules:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:100,message:"标题不能超过100个字",trigger:"blur"}]},{default:t(()=>[l(v,{modelValue:s.title,"onUpdate:modelValue":e[2]||(e[2]=a=>s.title=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"tag标签"},{default:t(()=>[l(Ae,{modelValue:s.tagId,"onUpdate:modelValue":e[3]||(e[3]=a=>s.tagId=a),options:H.value,placeholder:"请选择标签",style:{width:"240px"},multiple:"",filterable:"",remote:"","remote-method":Q},null,8,["modelValue","options"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"内容属性"},{default:t(()=>[l(Ne,{modelValue:s.attr,"onUpdate:modelValue":e[4]||(e[4]=a=>s.attr=a),onChange:we},{default:t(()=>[l(w,{label:"1",value:"1"},{default:t(()=>e[24]||(e[24]=[g("头条")])),_:1}),l(w,{label:"2",value:"2"},{default:t(()=>e[25]||(e[25]=[g("推荐")])),_:1}),l(w,{label:"3",value:"3"},{default:t(()=>e[26]||(e[26]=[g("轮播")])),_:1}),l(w,{label:"4",value:"4"},{default:t(()=>e[27]||(e[27]=[g("热门")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"发布时间"},{default:t(()=>[l(X,{modelValue:s.createdAt,"onUpdate:modelValue":e[5]||(e[5]=a=>s.createdAt=a),type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{class:"flex",label:"缩略图"},{default:t(()=>[l(ee,{class:"avatar-uploader","http-request":Ue,"show-file-list":!1,"before-upload":ke},{default:t(()=>[l(Y,{placement:"top-start",title:"上传",width:200,trigger:"hover",content:"上传图片作为封面图，大小200k内"},{reference:t(()=>[l(j,{class:"avatar-uploader-icon"},{default:t(()=>[l(Re)]),_:1})]),_:1})]),_:1}),s.img?(n(),c(Y,{key:0,placement:"right",width:400,trigger:"hover"},{reference:t(()=>[l(I,{class:"avatar-uploader-icon pointer ml-10",src:s.img},null,8,["src"])]),default:t(()=>[l(I,{style:{width:"100%"},src:s.img},null,8,["src"])]),_:1})):N("",!0),l(le,{type:"primary",class:"ml-10",onClick:e[6]||(e[6]=a=>h.value=!0)},{default:t(()=>e[28]||(e[28]=[g(" 默认封面图 ")])),_:1}),l(Te,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=a=>h.value=a),title:"默认封面图",class:"w-300","with-header":!1},{default:t(()=>[U("div",Ol,[(n(!0),V(C,null,E(ce.value,(a,S)=>(n(),c(I,{key:S,src:a,onClick:i=>_e(a),fit:"cover"},null,8,["src","onClick"]))),128))])]),_:1},8,["modelValue"]),l(v,{class:"ml-10 flex-1",modelValue:s.img,"onUpdate:modelValue":e[8]||(e[8]=a=>s.img=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(d,{label:"内容摘要"},{default:t(()=>[l(v,{type:"textarea",rows:2,placeholder:"请输入内容",modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=a=>s.description=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"文章内容"},{default:t(()=>[l(Il,{modelValue:s.content,"onUpdate:modelValue":e[10]||(e[10]=a=>s.content=a),setting:ne.value,onInit:ve,"script-src":"/public/admin/tinymce/tinymce.min.js"},null,8,["modelValue","setting"])]),_:1}),l(D,{gutter:20},{default:t(()=>[l(m,{sm:24,md:12,lg:8},{default:t(()=>[l(d,{label:"自动封面"},{default:t(()=>[l(w,{modelValue:L.value,"onUpdate:modelValue":e[12]||(e[12]=a=>L.value=a)},{default:t(()=>[e[29]||(e[29]=g(" 文章第 ")),l(v,{modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=a=>z.value=a),class:"w-80 mr-8 ml-8",placeholder:"请输入内容"},null,8,["modelValue"]),e[30]||(e[30]=g("张图 "))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12,lg:8},{default:t(()=>[l(d,{label:"提取描述"},{default:t(()=>[l(w,{modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=a=>O.value=a)},{default:t(()=>e[31]||(e[31]=[g("提取文章描述")])),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12,lg:8},{default:t(()=>[l(d,{label:"是否显示"},{default:t(()=>[l(F,{modelValue:s.status,"onUpdate:modelValue":e[14]||(e[14]=a=>s.status=a),value:"0"},{default:t(()=>e[32]||(e[32]=[g("发布")])),_:1},8,["modelValue"]),l(F,{modelValue:s.status,"onUpdate:modelValue":e[15]||(e[15]=a=>s.status=a),value:"1"},{default:t(()=>e[33]||(e[33]=[g("不发布")])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])),[[q,x.value==0],[$e,R.value]]),$(U("div",null,[l(D,{gutter:20},{default:t(()=>[l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"短标题",prop:"name"},{default:t(()=>[l(v,{modelValue:s.shortTitle,"onUpdate:modelValue":e[16]||(e[16]=a=>s.shortTitle=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"内容模板"},{default:t(()=>[l(te,{modelValue:s.articleView,"onUpdate:modelValue":e[17]||(e[17]=a=>s.articleView=a),placeholder:"请选择模板"},{default:t(()=>[(n(!0),V(C,null,E(J.value,a=>(n(),c(ae,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"来源"},{default:t(()=>[l(v,{modelValue:s.source,"onUpdate:modelValue":e[18]||(e[18]=a=>s.source=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"作者"},{default:t(()=>[l(v,{modelValue:s.author,"onUpdate:modelValue":e[19]||(e[19]=a=>s.author=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"外链跳转"},{default:t(()=>[l(v,{modelValue:s.link,"onUpdate:modelValue":e[20]||(e[20]=a=>s.link=a),max:"120"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{sm:24,md:12},{default:t(()=>[l(d,{label:"浏览数"},{default:t(()=>[l(v,{modelValue:s.pv,"onUpdate:modelValue":e[21]||(e[21]=a=>s.pv=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})],512),[[q,x.value==1]]),$(U("div",null,[l(D,{gutter:20},{default:t(()=>[(n(!0),V(C,null,E(f.value,(a,S)=>(n(),c(m,{key:S,sm:24,md:24,lg:24},{default:t(()=>[["1","7"].includes(a.type)?(n(),c(d,{key:0,label:a.cname},{default:t(()=>[l(v,{modelValue:a.values,"onUpdate:modelValue":i=>a.values=i,max:"120"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["2","9"].includes(a.type)?(n(),c(d,{key:1,label:a.cname},{default:t(()=>[l(v,{type:"textarea",rows:4,placeholder:"请输入内容",modelValue:a.values,"onUpdate:modelValue":i=>a.values=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["4"].includes(a.type)?(n(),c(d,{key:2,label:a.cname},{default:t(()=>[l(Le,{modelValue:a.values,"onUpdate:modelValue":i=>a.values=i},{default:t(()=>[(n(!0),V(C,null,E(a.defaultVal,i=>(n(),c(F,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["3","5"].includes(a.type)?(n(),c(d,{key:3,label:a.cname},{default:t(()=>[l(te,{modelValue:a.values,"onUpdate:modelValue":i=>a.values=i,placeholder:"请选择"},{default:t(()=>[(n(!0),V(C,null,E(a.defaultVal,i=>(n(),c(ae,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):a.type==="6"?(n(),c(d,{key:4,label:a.cname},{default:t(()=>[l(X,{modelValue:a.values,"onUpdate:modelValue":i=>a.values=i,"default-value":new Date,type:"datetime",placeholder:"请选择"},null,8,["modelValue","onUpdate:modelValue","default-value"])]),_:2},1032,["label"])):a.type==="8"?(n(),c(d,{key:5,label:a.cname,class:"flex align-c justify-center"},{default:t(()=>{var i;return[((i=a==null?void 0:a.values)==null?void 0:i.length)>0?(n(),V("div",Bl,[(n(!0),V(C,null,E(a.values,(k,qe)=>(n(),V("div",{class:"pos-r img-item",key:k.url},[(n(),c(I,{key:qe,src:k.url,fit:"cover"},null,8,["src"])),U("div",Pl,[l(j,{onClick:Me=>Ie(k)},{default:t(()=>[l(Oe)]),_:2},1032,["onClick"]),l(j,{onClick:Me=>xe(k)},{default:t(()=>[l(Be)]),_:2},1032,["onClick"])])]))),128))])):N("",!0),l(Pe,{modelValue:P.value,"onUpdate:modelValue":e[22]||(e[22]=k=>P.value=k)},{default:t(()=>[l(I,{"w-full":"",src:K.value,alt:"Preview Image"},null,8,["src"])]),_:1},8,["modelValue"]),l(ee,{multiple:"","http-request":Ee,data:{...a,index:S},"before-upload":Ce,limit:10,"show-file-list":!1},{default:t(()=>[l(j,{class:"upload-icon"},{default:t(()=>[l(he)]),_:1})]),_:2},1032,["data"])]}),_:2},1032,["label"])):N("",!0)]),_:2},1024))),128))]),_:1})],512),[[q,x.value==2&&f.value.length>0]]),l(d,null,{default:t(()=>[l(le,{type:"primary",onClick:e[23]||(e[23]=a=>Se(Z.value))},{default:t(()=>e[34]||(e[34]=[g("保存")])),_:1})]),_:1})]),_:1},8,["model"])])])}}},pa=xl(hl,[["__scopeId","data-v-f9faf703"]]);export{pa as default};
